<div class="row">
  <!-- ================= HORARIOS ================= -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        Horarios
      </div>
      <div class="card-body">

        <!-- Toast de notificación -->
        <div class="toast-container">
          <div class="mi-toast"
               [class.show]="mostrarToast"
               [class.hide]="!mostrarToast">

            <div class="toast-content">
              <span class="toast-icon">✔</span>
              <span class="toast-message">{{ mensajeToast }}</span>
            </div>

            <button class="toast-close" (click)="cerrarToast()">✖</button>

          </div>
        </div>

        <!-- Modal de confirmación para eliminar -->
        <div *ngIf="mostrarConfirmacion" 
             class="position-fixed top-50 start-50 translate-middle p-3 bg-white"
             style="z-index:1200; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.3); min-width:300px;">
          <p class="mb-3">{{ mensajeConfirmacion }}</p>
          <div class="text-end">
            <button class="btn btn-danger me-2" (click)="confirmarEliminar()">Sí</button>
            <button class="btn btn-secondary" (click)="cancelarEliminar()">No</button>
          </div>
        </div>

        <!-- Formulario Crear/Editar -->
        <form #horarioForm="ngForm" (ngSubmit)="editarHorario ? actualizarHorario() : crearHorario()">

          <div class="row g-2 mb-2">
            <div class="col">
              <label class="form-label">Hora Entrada</label>
              <input type="time" class="form-control" [(ngModel)]="horaEntrada" name="horaEntrada" required #horaE="ngModel">
              <div class="text-danger small" *ngIf="horaE.invalid && horaE.touched">Hora entrada requerida</div>
            </div>
            <div class="col">
              <label class="form-label">Hora Salida</label>
              <input type="time" class="form-control" [(ngModel)]="horaSalida" name="horaSalida" required #horaS="ngModel">
              <div class="text-danger small" *ngIf="horaS.invalid && horaS.touched">Hora salida requerida</div>
            </div>
          </div>

          <div class="row g-2 mb-2">
            <div class="col">
              <label class="form-label">Tolerancia (min)</label>
              <input type="number" class="form-control" [(ngModel)]="toleranciaMinutos" name="toleranciaMinutos" required min="0" #tol="ngModel">
              <div class="text-danger small" *ngIf="tol.invalid && tol.touched">Tolerancia requerida</div>
            </div>
            <div class="col">
              <label class="form-label">Descripción</label>
              <input type="text" class="form-control" [(ngModel)]="descripcion" name="descripcion" required #desc="ngModel">
              <div class="text-danger small" *ngIf="desc.invalid && desc.touched">Descripción requerida</div>
            </div>
          </div>

          <button type="submit" class="btn btn-success" [disabled]="horarioForm.invalid">
            {{ editarHorario ? 'Actualizar' : 'Crear' }}
          </button>
          <button type="button" class="btn btn-secondary" *ngIf="editarHorario" (click)="editarHorario = null">
            Cancelar
          </button>
        </form>

        <hr>

        <!-- Tabla de horarios -->
        <table class="table table-striped table-hover mt-3">
          <thead>
            <tr>
              <th>Entrada</th>
              <th>Salida</th>
              <th>Tolerancia</th>
              <th>Descripción</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let h of horarios">
              <td>{{ h.horaEntrada }}</td>
              <td>{{ h.horaSalida }}</td>
              <td>{{ h.toleranciaMinutos }}</td>
              <td>{{ h.descripcion }}</td>
              <td>
                <button class="btn btn-sm btn-primary me-1" (click)="prepararEditar(h)">Editar</button>
                <button class="btn btn-sm btn-danger" (click)="abrirConfirmacion(h.idHorario!)">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ================= ASIGNACIÓN HORARIOS ================= -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-header bg-success text-white">
        Asignar Horario a Empleado
      </div>
      <div class="card-body">

        <!-- Formulario Asignar -->
        <form #asignForm="ngForm" (ngSubmit)="asignarHorario()">
          <div class="row g-2 mb-2">
            <div class="col">
              <label class="form-label">Empleado</label>
              <select class="form-select" [(ngModel)]="asignacionRequest.idEmpleado" name="idEmpleado" required #emp="ngModel">
                <option value="0" disabled>Selecciona empleado</option>
                <option *ngFor="let e of empleados" [value]="e.id">
                {{ e.nombres }} {{ e.apellidos }}
                </option>
              </select>
              <div class="text-danger small" *ngIf="emp.invalid && emp.touched">Empleado requerido</div>
            </div>
            <div class="col">
              <label class="form-label">Horario</label>
              <select class="form-select" [(ngModel)]="asignacionRequest.idHorario" name="idHorario" required #hor="ngModel">
                <option value="0" disabled>Selecciona horario</option>
                <option *ngFor="let h of horarios" [value]="h.idHorario">{{ h.descripcion }} ({{ h.horaEntrada }} - {{ h.horaSalida }})</option>
              </select>
              <div class="text-danger small" *ngIf="hor.invalid && hor.touched">Horario requerido</div>
            </div>
          </div>

          <button type="submit" class="btn btn-success" [disabled]="asignForm.invalid">Asignar</button>
        </form>

        <hr>

        <!-- Tabla de Asignaciones -->
        <table class="table table-striped table-hover mt-3">
          <thead>
            <tr>
              <th>Empleado</th>
              <th>Horario</th>
              <th>Fecha Inicio</th>
              <th>Fecha Fin</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let a of asignaciones">
              <td>{{ a.empleado.nombres }}</td>
              <td>{{ a.horario.descripcion }} ({{ a.horario.horaEntrada }} - {{ a.horario.horaSalida }})</td>
              <td>{{ a.fechaInicio }}</td>
              <td>{{ a.fechaFin || '-' }}</td>
              <td>
                <button class="btn btn-sm btn-warning me-1" (click)="cerrarAsignacion(a.idHorarioEmpleado!)">Cerrar</button>
                <button class="btn btn-sm btn-danger" (click)="eliminarAsignacion(a.idHorarioEmpleado!)">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>

      </div>
    </div>
  </div>
</div>
